# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ccReIm-SJ8y4vypZU3mskfMlufG7hnLl
"""

import streamlit as st
import tensorflow as tf
import numpy as np

# á‹¨áŒˆáŒ¹ áˆ­á‹•áˆµ áŠ¥áŠ“ áˆ˜áŒáˆˆáŒ«
st.set_page_config(page_title="á‹¨áˆµáˆœá‰µ á‰µáŠ•á‰°áŠ“ (Sentiment Analysis)", page_icon="ğŸ§ ")
st.title("ğŸ§  áŠáˆáˆ/áˆáˆ­á‰µ áŒáˆáŒˆáˆ› áˆ˜á‰°áŠ•á‰°áŠ›")
st.write("áŠ áˆµá‰°á‹«á‹¨á‰µá‹áŠ• áŠ¨á‰³á‰½ á‹«áˆµáŒˆá‰¡á£ áˆá‹´áˆ‰ 'Positive' á‹ˆá‹­áˆ 'Negative' áˆ˜áˆ†áŠ‘áŠ• á‹­áŠáŒáˆ­á‹á‰³áˆá¢")

# 1. áˆá‹´áˆ‰áŠ• áŠ¥áŠ“ á‰¬áŠ­á‰°áˆ«á‹­á‹˜áˆ©áŠ• áˆ˜áŒ«áŠ• (Cache á‰ áˆ›á‹µáˆ¨áŒ ááŒ¥áŠá‰±áŠ• á‹­áŒ¨áˆáˆ«áˆ)
@st.cache_resource
def load_assets():
    model = tf.keras.models.load_model("sentiment_bilstm_model.keras")
    vec_model = tf.keras.models.load_model("vectorizer.keras")
    return model, vec_model.layers[0]

try:
    model, vectorizer = load_assets()
    st.success("âœ… áˆá‹´áˆ‰ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ­áŠ—áˆ!")
except Exception as e:
    st.error(f"âŒ á‹á‹­áˆá‰¹áŠ• áˆ˜áŒ«áŠ• áŠ áˆá‰°á‰»áˆˆáˆá¦ {e}")

# 2. á‹¨á‰°áŒ á‰ƒáˆš áŒá‰¥á‹“á‰µ (User Input)
user_text = st.text_area("áŠ áˆµá‰°á‹«á‹¨á‰µ áŠ¥á‹šáˆ… á‹­áŒ»á‰...", placeholder="áˆˆáˆáˆ³áˆŒá¦ This movie was incredible!")

if st.button("á‰°áŠ•á‰µáŠ•"):
    if user_text.strip() != "":
        # áŒ½áˆ‘á‰áŠ• á‹ˆá‹° á‰áŒ¥áˆ­ áˆ˜áˆˆá‹ˆáŒ¥
        vec_text = vectorizer([user_text])

        # áŒáˆá‰µ áˆ›áŒáŠ˜á‰µ
        prediction = model.predict(vec_text, verbose=0)[0][0]

        # á‹áŒ¤á‰±áŠ• áˆ›áˆ³á‹¨á‰µ
        st.divider()
        if prediction >= 0.5:
            st.balloons() # á‹°áˆµá‰³áŠ• áˆˆáˆ˜áŒáˆˆáŒ½
            st.subheader(f"á‹áŒ¤á‰µá¦ ğŸ˜Š Positive")
            st.progress(float(prediction))
            st.write(f"áŠ¥áˆ­áŒáŒ áŠáŠá‰µ (Score)á¦ {prediction:.2f}")
        else:
            st.subheader(f"á‹áŒ¤á‰µá¦ ğŸ˜ Negative")
            st.progress(float(prediction))
            st.write(f"áŠ¥áˆ­áŒáŒ áŠáŠá‰µ (Score)á¦ {prediction:.2f}")
    else:
        st.warning("áŠ¥á‰£áŠ­á‹ áˆ˜áŒ€áˆ˜áˆªá‹« áŒ½áˆ‘á á‹«áˆµáŒˆá‰¡á¢")
